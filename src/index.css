@import "tailwindcss";

/* ============================================
   BILINGUAL BIBLE - REFINED DESIGN SYSTEM
   Aesthetic: Illuminated Manuscript meets Modern Editorial
   ============================================ */

/* Light Theme (Default) - Warm Parchment */
:root,
[data-theme="light"] {
  --bg-primary: #FAF8F3;
  --bg-secondary: #F2EFE6;
  --bg-tertiary: #E8E4D9;
  --text-primary: #2D2A26;
  --text-secondary: #5C574E;
  --text-tertiary: #8A847A;
  --text-pinyin: rgba(92, 87, 78, 0.65);
  --accent: #8B5A2B;
  --accent-hover: #6B4423;
  --accent-light: #D4B896;
  --accent-subtle: rgba(139, 90, 43, 0.08);
  --border: #E0DCD2;
  --border-subtle: #EBE8E0;
  --shadow: rgba(45, 42, 38, 0.06);
  --shadow-md: rgba(45, 42, 38, 0.09);
  --shadow-elevated: rgba(45, 42, 38, 0.12);
  --overlay: rgba(250, 248, 243, 0.92);
  --overlay-dark: rgba(45, 42, 38, 0.15);
  --highlight: rgba(139, 90, 43, 0.12);
  --card-bg: #FFFFFF;
  --paper-texture: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
  --verse-glow: rgba(139, 90, 43, 0.06);
  --success: #5B7553;
  --success-bg: #E8F0E6;
  --error: #C44536;
  --error-bg: #F8E8E6;
  --hover-text: #9A5B2D;
  --highlight-text: #C2410C;
  --highlight-text-glow: rgba(194, 65, 12, 0.3);
}

/* Sepia Theme - Aged Manuscript */
[data-theme="sepia"] {
  --bg-primary: #F0E6D2;
  --bg-secondary: #E6DABC;
  --bg-tertiary: #DACCA6;
  --text-primary: #3D3225;
  --text-secondary: #5E5040;
  --text-tertiary: #7D6E5C;
  --text-pinyin: rgba(62, 50, 37, 0.6);
  --accent: #996B2D;
  --accent-hover: #7A5524;
  --accent-light: #C9A86C;
  --accent-subtle: rgba(153, 107, 45, 0.1);
  --border: #CDBF9E;
  --border-subtle: #DDD2B8;
  --shadow: rgba(61, 50, 37, 0.08);
  --shadow-md: rgba(61, 50, 37, 0.11);
  --shadow-elevated: rgba(61, 50, 37, 0.15);
  --overlay: rgba(240, 230, 210, 0.94);
  --overlay-dark: rgba(61, 50, 37, 0.18);
  --highlight: rgba(153, 107, 45, 0.15);
  --card-bg: #F8F0DC;
  --paper-texture: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
  --verse-glow: rgba(153, 107, 45, 0.08);
  --success: #5B7553;
  --success-bg: #E3E8DC;
  --error: #B33D2F;
  --error-bg: #EFE0DC;
  --hover-text: #7A5524;
  --highlight-text: #92400E;
  --highlight-text-glow: rgba(146, 64, 14, 0.35);
}

/* Dark Theme - Midnight Gold (Warm) */
[data-theme="dark"] {
  /* Warm brown-blacks: subtle red/amber undertones for candlelit comfort */
  --bg-primary: #0F0C0A;
  --bg-secondary: #1A1512;
  --bg-tertiary: #24201B;
  /* Warmer text: ivory/parchment tones instead of cool grays */
  --text-primary: #F5EFE3;
  --text-secondary: #B3A895;
  --text-tertiary: #7A7164;
  --text-pinyin: rgba(179, 168, 149, 0.7);
  /* Slightly warmer gold accent */
  --accent: #D9AF5D;
  --accent-hover: #E6C170;
  --accent-light: #3D3225;
  --accent-subtle: rgba(217, 175, 93, 0.12);
  /* Warm borders */
  --border: #2A2520;
  --border-subtle: #1F1A16;
  /* Warmer shadows with slight amber tint */
  --shadow: rgba(15, 10, 5, 0.35);
  --shadow-md: rgba(15, 10, 5, 0.45);
  --shadow-elevated: rgba(15, 10, 5, 0.55);
  --overlay: rgba(15, 12, 10, 0.92);
  --overlay-dark: rgba(10, 8, 5, 0.65);
  --highlight: rgba(217, 175, 93, 0.16);
  --card-bg: #1A1512;
  --paper-texture: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.015'/%3E%3C/svg%3E");
  --verse-glow: rgba(217, 175, 93, 0.06);
  --success: #7A9A6D;
  --success-bg: #1C2219;
  --error: #D87566;
  --error-bg: #2A1C1A;
  --hover-text: #D9AF5D;
  --highlight-text: #FCD34D;
  --highlight-text-glow: rgba(252, 211, 77, 0.4);
}

/* ============================================
   TEXT SIZE SYSTEM
   Dynamic sizing based on user preference
   ============================================ */

/* Small (X-Small) - Unchanged */
[data-text-size="sm"] {
  --chinese-base: 1rem;       /* 16px */
  --pinyin-base: 0.48em;
  --english-base: 0.875rem;   /* 14px */
  --verse-number-base: 0.6em;
}

/* Medium (Small) - Slightly increased */
[data-text-size="md"] {
  --chinese-base: 1.5rem;     /* 24px - was 22px */
  --pinyin-base: 0.48em;
  --english-base: 1.1875rem;  /* 19px - was 18px */
  --verse-number-base: 0.65em;
}

/* Large (Medium) - Slightly increased */
[data-text-size="lg"] {
  --chinese-base: 1.875rem;   /* 30px - was 28px */
  --pinyin-base: 0.48em;
  --english-base: 1.4375rem;  /* 23px - was 22px */
  --verse-number-base: 0.65em;
}

/* Extra Large (Large) - Significantly increased */
[data-text-size="xl"] {
  --chinese-base: 2.375rem;   /* 38px - was 32px */
  --pinyin-base: 0.48em;
  --english-base: 1.75rem;    /* 28px - was 24px */
  --verse-number-base: 0.65em;
}

/* 2X Large (X-Large) - Significantly increased */
[data-text-size="2xl"] {
  --chinese-base: 2.875rem;   /* 46px - was 36px */
  --pinyin-base: 0.48em;
  --english-base: 2.125rem;   /* 34px - was 28px */
  --verse-number-base: 0.65em;
}

/* ============================================
   Z-INDEX SYSTEM
   Organized by layers to prevent conflicts
   ============================================ */

/*
  ARCHITECTURE NOTES:

  Event Flow & Interaction Design:
  - TranslationPanel overlay: pointer-events-none allows scroll events to pass through
  - Modal backdrops: Click handling with e.target === e.currentTarget pattern
  - No scroll locking on body to allow reading while panels are open
  - Touch handlers (useLongPress) properly cancel on scroll to avoid conflicts

  Layer 1: Base Content (z-0 to z-10)
  - z-10: Sticky headers within content

  Layer 2: UI Chrome (z-20 to z-35)
  - z-30: Header, Translation panel overlay (pointer-events-none)
  - z-31: Translation panel content

  Layer 3: Modals & Overlays (z-45 to z-50)
  - z-45: Modal backdrops (BookNavigator, Settings, etc.)
  - z-46: Modal panels (BookNavigator, Settings)
  - z-47: Full-screen overlays (VocabularyScreen)
  - z-48: Nested full-screen overlays (FlashcardReview - above VocabularyScreen)
  - z-50: Reserved for temporary loading overlays
*/

/* ============================================
   BASE STYLES
   ============================================ */

* {
  box-sizing: border-box;
}

html {
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

body {
  margin: 0;
  padding: 0;
  min-height: 100vh;
  min-height: 100dvh;
  background-color: var(--bg-primary);
  background-image: var(--paper-texture);
  color: var(--text-primary);
  font-family: 'Crimson Pro', 'Georgia', serif;
  line-height: 1.7;
  letter-spacing: 0.01em;
  transition: background-color 0.4s ease, color 0.4s ease;
}

#root {
  min-height: 100vh;
  min-height: 100dvh;
}

/* ============================================
   TYPOGRAPHY - REFINED
   ============================================ */

/* Display headings - Elegant Garamond */
.font-display {
  font-family: 'Cormorant Garamond', 'Georgia', serif;
  font-weight: 400;
  letter-spacing: 0.02em;
}

/* Body text - Refined Crimson */
.font-body {
  font-family: 'Crimson Pro', 'Georgia', serif;
}

/* Chinese Typography - Beautiful Serif */
.font-chinese-serif {
  font-family: 'Noto Serif TC', 'Source Han Serif TC', 'Songti TC', serif;
  font-weight: 400;
}

.font-chinese-sans {
  font-family: 'Noto Sans TC', 'Source Han Sans TC', 'PingFang TC', sans-serif;
}

/* Chinese text sizing with optimized line height for density */
.text-chinese {
  font-size: var(--chinese-size, var(--chinese-base, 1.25rem));
  line-height: 1.85;
  letter-spacing: 0;
}

.text-chinese-sm {
  --chinese-size: 1rem;        /* 16px - XS */
  line-height: 1.8;
}
.text-chinese-md {
  --chinese-size: 1.5rem;      /* 24px - S */
  line-height: 1.85;
}
.text-chinese-lg {
  --chinese-size: 1.875rem;    /* 30px - M */
  line-height: 1.9;
}
.text-chinese-xl {
  --chinese-size: 2.375rem;    /* 38px - L */
  line-height: 1.95;
}
.text-chinese-2xl {
  --chinese-size: 2.875rem;    /* 46px - XL */
  line-height: 2;
}

/* Responsive Chinese text sizing for larger screens */
@media (min-width: 1024px) {
  .text-chinese-sm { --chinese-size: 1.125rem; }  /* lg: 18px */
  .text-chinese-md { --chinese-size: 1.625rem; }  /* lg: 26px */
  .text-chinese-lg { --chinese-size: 2rem; }      /* lg: 32px */
  .text-chinese-xl { --chinese-size: 2.5rem; }    /* lg: 40px */
  .text-chinese-2xl { --chinese-size: 3rem; }     /* lg: 48px */
}

@media (min-width: 1280px) {
  .text-chinese-sm { --chinese-size: 1.25rem; }   /* xl: 20px */
  .text-chinese-md { --chinese-size: 1.75rem; }   /* xl: 28px */
  .text-chinese-lg { --chinese-size: 2.125rem; }  /* xl: 34px */
  .text-chinese-xl { --chinese-size: 2.625rem; }  /* xl: 42px */
  .text-chinese-2xl { --chinese-size: 3.125rem; } /* xl: 50px */
}

/* ============================================
   PINYIN TEXT - Refined Serif Typography
   ============================================ */

.pinyin-text {
  display: flex;
  justify-content: center;
  align-items: center;
  /* Elegant serif stack optimized for pinyin diacriticals
     - Crimson Pro: Primary choice, excellent Unicode support for tone marks
     - Noto Serif: Comprehensive fallback with perfect diacritic rendering
     - Georgia: Universal serif fallback with good accent handling
     - Times New Roman: System fallback for Windows
     All fonts tested for consistent sizing with ā ǎ à á ü ǚ ǜ ǹ etc. */
  font-family: 'Crimson Pro', 'Noto Serif', 'Georgia', 'Times New Roman', serif;
  font-size: var(--pinyin-base, 0.48em);
  font-weight: 400;
  font-style: normal; /* CRITICAL: No italic - prevents sizing inconsistencies with diacritics */
  color: var(--text-pinyin);
  letter-spacing: 0.01em; /* Subtle spacing for serif elegance */
  line-height: 1.3;
  white-space: nowrap;
  transition: opacity 0.25s ease, color 0.25s ease;
  margin-bottom: -0.1em;
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none; /* Prevent iOS callout menu */
  width: 100%;
  /* Enhanced font rendering for crisp serifs at small sizes */
  font-feature-settings: 'kern' 1, 'liga' 1;
  text-rendering: optimizeLegibility;
}

.chinese-char {
  display: block;
  line-height: 1.45;
  font-feature-settings: 'liga' 1, 'calt' 1;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  transition: color 0.3s cubic-bezier(0.4, 0, 0.2, 1), text-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Multi-character word alignment - pinyin above each character */
.char-pinyin-pairs {
  display: inline-flex;
  flex-direction: row;
  align-items: flex-end;
}

.char-pinyin-unit {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
}

.char-pinyin-unit .pinyin-text {
  width: auto;
  min-width: 100%;
}

.char-pinyin-unit .chinese-char {
  display: block;
}

/* ============================================
   VERSE STYLING - Editorial
   ============================================ */

.verse {
  position: relative;
  padding: 0.15rem 0;
  transition: background-color 0.3s ease, opacity 0.4s ease, filter 0.4s ease;
  /* Performance: Use CSS containment for verse blocks */
  contain: layout style;
  /* Prevent iOS text selection on long-press */
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none; /* Prevent iOS callout menu */
}

/* Active verse (shown only when verse translation panel is open) */
.verse.verse-active,
.verse-inline.verse-active {
  color: var(--hover-text);
}

.verse.verse-active .pinyin-text,
.verse-inline.verse-active .pinyin-text {
  color: var(--hover-text);
  opacity: 0.85;
}

.verse-number {
  font-family: 'Cormorant Garamond', serif;
  font-size: var(--verse-number-base, 0.65em);
  font-weight: 600;
  color: var(--accent);
  vertical-align: super;
  margin-right: 0.35em;
  opacity: 0.85;
  /* Removed transition to prevent blinking during scroll */
}

/* Hover-only effects (avoid sticky :hover on touch devices) */
@media (hover: hover) and (pointer: fine) {
  .verse:hover .verse-number {
    opacity: 1;
  }
}

/* ============================================
   PROSE VERSE STYLING (Paragraph Flow)
   For narrative books like Genesis, Matthew, etc.
   ============================================ */

.prose-verses {
  /* Inline flow container - verses wrap like paragraphs */
  text-indent: 1.5em;
  line-height: 1.85;
  /* Eliminate whitespace between inline-flex elements */
  font-size: 0;
}

.prose-verses .chinese-word,
.prose-verses > span {
  /* Reset font-size for children (verse-number-inline keeps its own smaller size) */
  font-size: var(--chinese-size, var(--chinese-base, 1.25rem));
}

/* Paragraph break - creates visual separation between paragraphs in prose mode */
.paragraph-break {
  display: block;
  width: 100%;
  height: 0.75em;
  content: '';
}

.verse-inline {
  /* Inline display for prose flow */
  position: relative;
  transition: background-color 0.3s ease, opacity 0.4s ease, filter 0.4s ease;
  border-radius: 2px;
  /* Performance: Lighter containment for inline elements */
  contain: style;
  /* Prevent iOS text selection on long-press */
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none; /* Prevent iOS callout menu */
}

.verse-number-inline {
  /* Superscript numerals - prominent reference marks for easy verse scanning
     Uses elevated baseline positioning with refined typography for clarity */
  font-family: 'Crimson Pro', 'Georgia', serif;
  font-size: 0.75rem !important; /* ~12px - significantly more readable */
  font-weight: 700;
  font-style: normal;
  color: var(--accent);
  vertical-align: super;
  margin: 0 0.25em; /* Increased margin for better breathing room */
  padding: 0.1em 0.35em; /* Add padding for subtle background */
  opacity: 0.95; /* Higher opacity for better visibility */
  /* Removed transitions to prevent blinking during scroll */
  letter-spacing: -0.01em;
  font-feature-settings: 'tnum' 1, 'lnum' 1; /* Tabular & lining numerals for alignment */
  background-color: var(--accent-subtle); /* Subtle background for distinction */
  border-radius: 3px; /* Rounded corners for elegance */
  /* Enhanced text shadow for better separation */
  text-shadow:
    0 0.5px 1px rgba(255, 255, 255, 0.4);
}

/* First verse number shouldn't have left margin (after indent) */
.prose-verses > .verse-inline:first-child .verse-number-inline {
  margin-left: 0;
}

@media (hover: hover) and (pointer: fine) {
  .verse-inline:hover .verse-number-inline {
    opacity: 1; /* Full opacity on hover for maximum clarity */
    /* Removed scale transform to prevent visual jumps during scroll */
    color: var(--accent-hover); /* Subtle color shift on interaction */
  }
}

/* Active verse in prose mode */
.verse-inline.verse-active {
  position: relative;
}

.chapter-title {
  font-family: 'Cormorant Garamond', serif;
  font-size: 1.5rem;
  font-weight: 300;
  text-align: center;
  color: var(--text-secondary);
  padding: 1.5rem 0;
  letter-spacing: 0.15em;
  text-transform: uppercase;
}

/* Decorative chapter divider */
.chapter-title::after {
  content: '';
  display: block;
  width: 60px;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent-light), transparent);
  margin: 0.75rem auto 0;
}

/* ============================================
   WORD INTERACTION - Elegant
   ============================================ */

.chinese-word {
  cursor: pointer;
  border-radius: 3px;
  transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1);
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  padding: 0;
  margin: 0;
  position: relative;
  vertical-align: bottom;
  /* Performance: Use CSS containment to isolate rendering */
  contain: layout style;
  /* Eliminates 300ms tap delay on mobile */
  touch-action: manipulation;
  /* Prevent iOS text selection on tap-and-hold */
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none; /* Prevent iOS callout menu */
}

.chinese-word .chinese-char,
.chinese-word .pinyin-text {
  transition: color 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Word holding feedback - highlight only the held word */
/* Holding a word - highlight text only (no verse-wide highlight) */
.chinese-word.word-holding .chinese-char,
.chinese-word.word-holding .pinyin-text {
  color: var(--accent);
}

/* Hover highlights only the specific word (not verse) - text color change */
@media (hover: hover) and (pointer: fine) {
  .chinese-word:hover:not(:active):not(.active) .chinese-char,
  .chinese-word:hover:not(:active):not(.active) .pinyin-text {
    color: var(--hover-text);
  }
}

.chinese-word:active .chinese-char,
.chinese-word:active .pinyin-text,
.chinese-word.active .chinese-char,
.chinese-word.active .pinyin-text {
  color: var(--hover-text);
}

.chinese-word:active,
.chinese-word.active {
  transform: scale(1.02);
  /* Only use will-change during active interaction */
  will-change: transform;
}

.chinese-word.saved {
  position: relative;
}

.chinese-word.saved::before {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 10%;
  right: 10%;
  height: 1px;
  background: var(--accent);
  opacity: 0.3;
}

/* HSK Level indicators - Subtle dots */
.chinese-word[data-hsk]::after {
  content: '';
  position: absolute;
  top: -3px;
  right: -3px;
  width: 5px;
  height: 5px;
  border-radius: 50%;
  opacity: 0.7;
  bottom: auto;
  left: auto;
  transform: none;
  transition: opacity 0.2s ease;
}

.chinese-word[data-hsk="1"]::after { background-color: #4CAF50; }
.chinese-word[data-hsk="2"]::after { background-color: #8BC34A; }
.chinese-word[data-hsk="3"]::after { background-color: #FFC107; }
.chinese-word[data-hsk="4"]::after { background-color: #FF9800; }
.chinese-word[data-hsk="5"]::after { background-color: #FF5722; }
.chinese-word[data-hsk="6"]::after { background-color: #9C27B0; }

[data-show-hsk="false"] .chinese-word[data-hsk]::after {
  display: none;
}

/* ============================================
   AUDIO PLAYBACK - FOCUS MODE
   ============================================ */

[data-audio-playing="true"] .verse:not(.verse-active) {
  opacity: 0.4;
  /* Removed blur filter for better scroll performance on mobile */
  transition: opacity 0.4s ease;
}

[data-audio-playing="true"] .verse-active {
  opacity: 1;
  filter: none;
  position: relative;
}

/* Word Highlight - Elegant Inline Text Color Illumination (No Background) */
.word-highlight {
  background-color: transparent !important;
  background: none !important;
}

.word-highlight .chinese-char {
  color: var(--highlight-text);
  font-weight: 500;
  text-shadow:
    0 0 16px var(--highlight-text-glow),
    0 0 24px var(--highlight-text-glow),
    0 1px 2px rgba(0, 0, 0, 0.1);
  animation: textIlluminate 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  transition: color 0.35s cubic-bezier(0.4, 0, 0.2, 1),
              text-shadow 0.35s cubic-bezier(0.4, 0, 0.2, 1),
              font-weight 0.35s cubic-bezier(0.4, 0, 0.2, 1);
}

.word-highlight .pinyin-text {
  color: var(--highlight-text);
  opacity: 0.9;
  font-weight: 500;
  text-shadow:
    0 0 10px var(--highlight-text-glow),
    0 1px 2px rgba(0, 0, 0, 0.08);
  animation: pinyinIlluminate 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  transition: color 0.35s cubic-bezier(0.4, 0, 0.2, 1),
              opacity 0.35s cubic-bezier(0.4, 0, 0.2, 1),
              text-shadow 0.35s cubic-bezier(0.4, 0, 0.2, 1),
              font-weight 0.35s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Word Selected - Persistent Highlight While Definition Card Is Showing */
.word-selected .chinese-char {
  color: var(--accent);
  font-weight: 500;
  transition: color 0.25s cubic-bezier(0.4, 0, 0.2, 1),
              font-weight 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

.word-selected .pinyin-text {
  color: var(--accent);
  opacity: 0.85;
  font-weight: 500;
  transition: color 0.25s cubic-bezier(0.4, 0, 0.2, 1),
              opacity 0.25s cubic-bezier(0.4, 0, 0.2, 1),
              font-weight 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes textIlluminate {
  0% {
    color: var(--text-primary);
    text-shadow: none;
    transform: scale(1);
    font-weight: 400;
  }
  35% {
    transform: scale(1.05);
    text-shadow:
      0 0 20px var(--highlight-text-glow),
      0 0 32px var(--highlight-text-glow),
      0 1px 3px rgba(0, 0, 0, 0.12);
  }
  100% {
    color: var(--highlight-text);
    text-shadow:
      0 0 16px var(--highlight-text-glow),
      0 0 24px var(--highlight-text-glow),
      0 1px 2px rgba(0, 0, 0, 0.1);
    transform: scale(1);
    font-weight: 500;
  }
}

@keyframes pinyinIlluminate {
  0% {
    color: var(--text-pinyin);
    opacity: 0.65;
    text-shadow: none;
    transform: translateY(0);
    font-weight: 400;
  }
  35% {
    transform: translateY(-1px);
    text-shadow:
      0 0 14px var(--highlight-text-glow),
      0 1px 3px rgba(0, 0, 0, 0.1);
  }
  100% {
    color: var(--highlight-text);
    opacity: 0.9;
    text-shadow:
      0 0 10px var(--highlight-text-glow),
      0 1px 2px rgba(0, 0, 0, 0.08);
    transform: translateY(0);
    font-weight: 500;
  }
}

/* ============================================
   SCROLLBAR - Refined
   ============================================ */

::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 4px;
  border: 2px solid var(--bg-primary);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-tertiary);
}

/* ============================================
   ANIMATIONS - Elegant & Subtle
   ============================================ */

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(24px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-16px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.96);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes shimmer {
  0% { background-position: -200% center; }
  100% { background-position: 200% center; }
}

.animate-fade-in { animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
.animate-slide-up { animation: slideUp 0.35s cubic-bezier(0.4, 0, 0.2, 1); }
.animate-slide-down { animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
.animate-scale-in { animation: scaleIn 0.25s cubic-bezier(0.4, 0, 0.2, 1); }

/* Staggered entrance animations */
.stagger-1 { animation-delay: 0.05s; }
.stagger-2 { animation-delay: 0.1s; }
.stagger-3 { animation-delay: 0.15s; }
.stagger-4 { animation-delay: 0.2s; }
.stagger-5 { animation-delay: 0.25s; }

/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* ============================================
   UTILITY CLASSES
   ============================================ */

/* Disable text selection on iOS for gesture-interactive elements */
[role="button"] {
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}

.safe-area-top {
  padding-top: env(safe-area-inset-top, 0);
}

.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom, 0);
}

.no-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

.no-scrollbar::-webkit-scrollbar {
  display: none;
}

/* Refined touch feedback - instant response */
.touch-feedback {
  -webkit-tap-highlight-color: transparent;
  transition: transform 0.1s cubic-bezier(0.2, 0, 0.2, 1), opacity 0.1s ease;
  touch-action: manipulation; /* Eliminates 300ms tap delay */
  will-change: transform;
}

.touch-feedback:active {
  transform: scale(0.97);
  opacity: 0.8;
  transition-duration: 0.05s;
}

/* Elegant selection */
::selection {
  background-color: var(--highlight);
  color: var(--text-primary);
}

/* Glass effect for overlays - Optimized for mobile performance */
.glass {
  /* Replaced expensive backdrop-filter with semi-transparent background */
  background-color: var(--overlay);
  /* Only use backdrop-filter on desktop where GPU is stronger */
  @media (min-width: 1024px) {
    backdrop-filter: blur(8px) saturate(150%);
    -webkit-backdrop-filter: blur(8px) saturate(150%);
  }
}

/* Shadow utilities */
.shadow-sm {
  box-shadow:
    0 1px 2px var(--shadow),
    0 1px 3px -1px var(--shadow);
}

.shadow-md {
  box-shadow:
    0 2px 4px -1px var(--shadow),
    0 4px 8px -2px var(--shadow-md);
}

.shadow-elevated {
  box-shadow:
    0 4px 6px -1px var(--shadow),
    0 10px 20px -5px var(--shadow-elevated),
    0 1px 3px var(--shadow);
}

.shadow-panel {
  box-shadow:
    0 2px 8px -2px var(--shadow),
    0 8px 16px -4px var(--shadow-md),
    0 0 0 1px var(--border-subtle);
}

/* Decorative border gradient */
.border-gradient {
  border: 1px solid transparent;
  background:
    linear-gradient(var(--card-bg), var(--card-bg)) padding-box,
    linear-gradient(135deg, var(--border), var(--accent-light), var(--border)) border-box;
}

/* ============================================
   GESTURE TUTORIAL - Illuminated Manuscript Style
   ============================================ */

.gesture-tutorial-overlay {
  position: fixed;
  inset: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-primary);
  overflow: hidden;
}

/* Subtle decorative pattern background */
.gesture-tutorial-pattern {
  position: absolute;
  inset: 0;
  opacity: 0.03;
  background-image:
    radial-gradient(circle at 20% 30%, var(--accent) 1px, transparent 1px),
    radial-gradient(circle at 80% 70%, var(--accent) 1px, transparent 1px);
  background-size: 60px 60px;
  pointer-events: none;
}

.gesture-tutorial-content {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  max-width: 400px;
  padding: 2rem 1.5rem;
  text-align: center;
}

/* Header with ornamental decorations */
.gesture-tutorial-header {
  margin-bottom: 2rem;
}

.gesture-ornament {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.gesture-ornament-line {
  width: 40px;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent), transparent);
}

.gesture-ornament-diamond {
  width: 8px;
  height: 8px;
  background: var(--accent);
  transform: rotate(45deg);
  opacity: 0.8;
}

.gesture-tutorial-title {
  font-family: 'Cormorant Garamond', 'Georgia', serif;
  font-size: 1.25rem;
  font-weight: 400;
  letter-spacing: 0.08em;
  color: var(--text-secondary);
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.gesture-title-divider {
  color: var(--accent);
  font-size: 1.5rem;
  line-height: 1;
}

/* Gesture card */
.gesture-card-container {
  width: 100%;
  min-height: 320px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 1.5rem;
}

.gesture-card {
  width: 100%;
  padding: 2rem 1.5rem;
  background: var(--card-bg);
  border: 1px solid var(--border-subtle);
  border-radius: 12px;
  box-shadow:
    0 4px 20px -4px var(--shadow),
    0 8px 40px -8px var(--shadow-md),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  position: relative;
  overflow: hidden;
}

/* Decorative corner accents */
.gesture-card::before,
.gesture-card::after {
  content: '';
  position: absolute;
  width: 24px;
  height: 24px;
  border: 1px solid var(--accent);
  opacity: 0.3;
}

.gesture-card::before {
  top: 12px;
  left: 12px;
  border-right: none;
  border-bottom: none;
}

.gesture-card::after {
  bottom: 12px;
  right: 12px;
  border-left: none;
  border-top: none;
}

/* Gesture icon wrapper */
.gesture-icon-wrapper {
  width: 120px;
  height: 120px;
  margin: 0 auto 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.gesture-hand {
  width: 100%;
  height: 100%;
}

/* Gesture title styling */
.gesture-card-title {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
  margin-bottom: 1rem;
}

.gesture-chinese {
  font-family: 'Noto Serif TC', 'Source Han Serif TC', serif;
  font-size: 1.75rem;
  font-weight: 600;
  color: var(--text-primary);
  letter-spacing: 0.1em;
}

.gesture-pinyin {
  font-family: 'Crimson Pro', 'Georgia', serif;
  font-size: 0.875rem;
  font-style: italic;
  color: var(--text-pinyin);
  letter-spacing: 0.02em;
}

.gesture-english {
  font-family: 'Cormorant Garamond', 'Georgia', serif;
  font-size: 1rem;
  font-weight: 500;
  color: var(--accent);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  margin-top: 0.25rem;
}

/* Description */
.gesture-description {
  font-size: 1rem;
  line-height: 1.7;
  color: var(--text-secondary);
  margin: 0;
}

.gesture-desc-english {
  font-family: 'Crimson Pro', 'Georgia', serif;
  font-style: italic;
  color: var(--text-tertiary);
  font-size: 0.9375rem;
}

/* Duration badge */
.gesture-duration {
  display: inline-block;
  margin-top: 1rem;
  padding: 0.25rem 0.75rem;
  background: var(--accent-subtle);
  border: 1px solid var(--accent);
  border-radius: 100px;
  font-family: 'SF Mono', 'Consolas', monospace;
  font-size: 0.75rem;
  color: var(--accent);
  letter-spacing: 0.05em;
}

/* Progress dots */
.gesture-progress {
  display: flex;
  gap: 0.75rem;
  margin-bottom: 2rem;
}

.gesture-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--border);
  border: none;
  padding: 0;
  cursor: pointer;
  transition: all 0.3s ease;
}

.gesture-dot.active {
  background: var(--accent);
  transform: scale(1.25);
  box-shadow: 0 0 0 4px var(--accent-subtle);
}

.gesture-dot:hover:not(.active) {
  background: var(--text-tertiary);
}

/* Navigation buttons */
.gesture-nav {
  display: flex;
  gap: 1rem;
  width: 100%;
  max-width: 320px;
}

.gesture-nav-btn {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.875rem 1.25rem;
  border-radius: 8px;
  font-family: 'Cormorant Garamond', 'Georgia', serif;
  font-size: 1rem;
  font-weight: 600;
  letter-spacing: 0.05em;
  cursor: pointer;
  transition: all 0.2s ease;
  border: none;
}

.gesture-nav-btn.primary {
  background: var(--accent);
  color: white;
  box-shadow:
    0 2px 8px -2px var(--shadow-md),
    0 4px 12px -4px rgba(139, 90, 43, 0.3);
}

.gesture-nav-btn.primary:hover {
  background: var(--accent-hover);
}

.gesture-nav-btn.secondary {
  background: transparent;
  color: var(--text-secondary);
  border: 1px solid var(--border);
}

.gesture-nav-btn.secondary:hover {
  background: var(--bg-secondary);
  border-color: var(--text-tertiary);
}

/* Mobile adjustments */
@media (max-width: 400px) {
  .gesture-tutorial-content {
    padding: 1.5rem 1rem;
  }

  .gesture-card {
    padding: 1.5rem 1rem;
  }

  .gesture-chinese {
    font-size: 1.5rem;
  }

  .gesture-nav {
    flex-direction: column-reverse;
  }
}
